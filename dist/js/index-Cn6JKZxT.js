import{E as Fe,V as h,M as N,T as R,S as Q,Q as ye,a as E,R as Ke,P as Ue,b as Ze,c as Xe,d as We,W as Be,C as Ee,A as qe,e as Ve,B as Ge,f as Je,g as Qe,h as $e}from"./three-DUqQ6dlx.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&e(m)}).observe(document,{childList:!0,subtree:!0});function c(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(n){if(n.ep)return;n.ep=!0;const a=c(n);fetch(n.href,a)}})();const we={type:"change"},J={type:"start"},Pe={type:"end"},X=new Ke,Te=new Ue,et=Math.cos(70*Ze.DEG2RAD);class tt extends Fe{constructor(s,c){super(),this.object=s,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new h,this.cursor=new h,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.touches={ONE:R.ROTATE,TWO:R.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",V),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",V),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(we),e.update(),a=n.NONE},this.update=function(){const t=new h,o=new ye().setFromUnitVectors(s.up,new h(0,1,0)),u=o.clone().invert(),d=new h,b=new ye,j=new h,O=2*Math.PI;return function(ve=null){const be=e.object.position;t.copy(be).sub(e.target),t.applyQuaternion(o),r.setFromVector3(t),e.autoRotate&&a===n.NONE&&z(Oe(ve)),e.enableDamping?(r.theta+=f.theta*e.dampingFactor,r.phi+=f.phi*e.dampingFactor):(r.theta+=f.theta,r.phi+=f.phi);let w=e.minAzimuthAngle,P=e.maxAzimuthAngle;isFinite(w)&&isFinite(P)&&(w<-Math.PI?w+=O:w>Math.PI&&(w-=O),P<-Math.PI?P+=O:P>Math.PI&&(P-=O),w<=P?r.theta=Math.max(w,Math.min(P,r.theta)):r.theta=r.theta>(w+P)/2?Math.max(w,r.theta):Math.min(P,r.theta)),r.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,r.phi)),r.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(p,e.dampingFactor):e.target.add(p),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor),e.zoomToCursor&&_||e.object.isOrthographicCamera?r.radius=B(r.radius):r.radius=B(r.radius*l),t.setFromSpherical(r),t.applyQuaternion(u),be.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,p.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),p.set(0,0,0));let U=!1;if(e.zoomToCursor&&_){let Y=null;if(e.object.isPerspectiveCamera){const H=t.length();Y=B(H*l);const Z=H-Y;e.object.position.addScaledVector(ee,Z),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const H=new h(T.x,T.y,0);H.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/l)),e.object.updateProjectionMatrix(),U=!0;const Z=new h(T.x,T.y,0);Z.unproject(e.object),e.object.position.sub(Z).add(H),e.object.updateMatrixWorld(),Y=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;Y!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(Y).add(e.object.position):(X.origin.copy(e.object.position),X.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(X.direction))<et?s.lookAt(e.target):(Te.setFromNormalAndCoplanarPoint(e.object.up,e.target),X.intersectPlane(Te,e.target))))}else e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/l)),e.object.updateProjectionMatrix(),U=!0);return l=1,_=!1,U||d.distanceToSquared(e.object.position)>m||8*(1-b.dot(e.object.quaternion))>m||j.distanceToSquared(e.target)>0?(e.dispatchEvent(we),d.copy(e.object.position),b.copy(e.object.quaternion),j.copy(e.target),U=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",fe),e.domElement.removeEventListener("pointerdown",pe),e.domElement.removeEventListener("pointercancel",k),e.domElement.removeEventListener("wheel",me),e.domElement.removeEventListener("pointermove",q),e.domElement.removeEventListener("pointerup",k),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",V),e._domElementKeyEvents=null)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=n.NONE;const m=1e-6,r=new Q,f=new Q;let l=1;const p=new h,g=new E,y=new E,S=new E,M=new E,C=new E,x=new E,A=new E,L=new E,I=new E,ee=new h,T=new E;let _=!1;const i=[],v={};function Oe(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function F(){return Math.pow(.95,e.zoomSpeed)}function z(t){f.theta-=t}function K(t){f.phi-=t}const te=function(){const t=new h;return function(u,d){t.setFromMatrixColumn(d,0),t.multiplyScalar(-u),p.add(t)}}(),oe=function(){const t=new h;return function(u,d){e.screenSpacePanning===!0?t.setFromMatrixColumn(d,1):(t.setFromMatrixColumn(d,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(u),p.add(t)}}(),D=function(){const t=new h;return function(u,d){const b=e.domElement;if(e.object.isPerspectiveCamera){const j=e.object.position;t.copy(j).sub(e.target);let O=t.length();O*=Math.tan(e.object.fov/2*Math.PI/180),te(2*u*O/b.clientHeight,e.object.matrix),oe(2*d*O/b.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(te(u*(e.object.right-e.object.left)/e.object.zoom/b.clientWidth,e.object.matrix),oe(d*(e.object.top-e.object.bottom)/e.object.zoom/b.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function W(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?l/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ne(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?l*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ae(t){if(!e.zoomToCursor)return;_=!0;const o=e.domElement.getBoundingClientRect(),u=t.clientX-o.left,d=t.clientY-o.top,b=o.width,j=o.height;T.x=u/b*2-1,T.y=-(d/j)*2+1,ee.set(T.x,T.y,1).unproject(e.object).sub(e.object.position).normalize()}function B(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function ie(t){g.set(t.clientX,t.clientY)}function Me(t){ae(t),A.set(t.clientX,t.clientY)}function se(t){M.set(t.clientX,t.clientY)}function Ce(t){y.set(t.clientX,t.clientY),S.subVectors(y,g).multiplyScalar(e.rotateSpeed);const o=e.domElement;z(2*Math.PI*S.x/o.clientHeight),K(2*Math.PI*S.y/o.clientHeight),g.copy(y),e.update()}function Se(t){L.set(t.clientX,t.clientY),I.subVectors(L,A),I.y>0?W(F()):I.y<0&&ne(F()),A.copy(L),e.update()}function xe(t){C.set(t.clientX,t.clientY),x.subVectors(C,M).multiplyScalar(e.panSpeed),D(x.x,x.y),M.copy(C),e.update()}function Ae(t){ae(t),t.deltaY<0?ne(F()):t.deltaY>0&&W(F()),e.update()}function Le(t){let o=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?K(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(0,e.keyPanSpeed),o=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?K(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(0,-e.keyPanSpeed),o=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?z(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(e.keyPanSpeed,0),o=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?z(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(-e.keyPanSpeed,0),o=!0;break}o&&(t.preventDefault(),e.update())}function re(){if(i.length===1)g.set(i[0].pageX,i[0].pageY);else{const t=.5*(i[0].pageX+i[1].pageX),o=.5*(i[0].pageY+i[1].pageY);g.set(t,o)}}function ce(){if(i.length===1)M.set(i[0].pageX,i[0].pageY);else{const t=.5*(i[0].pageX+i[1].pageX),o=.5*(i[0].pageY+i[1].pageY);M.set(t,o)}}function le(){const t=i[0].pageX-i[1].pageX,o=i[0].pageY-i[1].pageY,u=Math.sqrt(t*t+o*o);A.set(0,u)}function De(){e.enableZoom&&le(),e.enablePan&&ce()}function je(){e.enableZoom&&le(),e.enableRotate&&re()}function ue(t){if(i.length==1)y.set(t.pageX,t.pageY);else{const u=G(t),d=.5*(t.pageX+u.x),b=.5*(t.pageY+u.y);y.set(d,b)}S.subVectors(y,g).multiplyScalar(e.rotateSpeed);const o=e.domElement;z(2*Math.PI*S.x/o.clientHeight),K(2*Math.PI*S.y/o.clientHeight),g.copy(y)}function de(t){if(i.length===1)C.set(t.pageX,t.pageY);else{const o=G(t),u=.5*(t.pageX+o.x),d=.5*(t.pageY+o.y);C.set(u,d)}x.subVectors(C,M).multiplyScalar(e.panSpeed),D(x.x,x.y),M.copy(C)}function he(t){const o=G(t),u=t.pageX-o.x,d=t.pageY-o.y,b=Math.sqrt(u*u+d*d);L.set(0,b),I.set(0,Math.pow(L.y/A.y,e.zoomSpeed)),W(I.y),A.copy(L)}function Ne(t){e.enableZoom&&he(t),e.enablePan&&de(t)}function Re(t){e.enableZoom&&he(t),e.enableRotate&&ue(t)}function pe(t){e.enabled!==!1&&(i.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",q),e.domElement.addEventListener("pointerup",k)),He(t),t.pointerType==="touch"?ke(t):Ie(t))}function q(t){e.enabled!==!1&&(t.pointerType==="touch"?Ye(t):ze(t))}function k(t){_e(t),i.length===0&&(e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",q),e.domElement.removeEventListener("pointerup",k)),e.dispatchEvent(Pe),a=n.NONE}function Ie(t){let o;switch(t.button){case 0:o=e.mouseButtons.LEFT;break;case 1:o=e.mouseButtons.MIDDLE;break;case 2:o=e.mouseButtons.RIGHT;break;default:o=-1}switch(o){case N.DOLLY:if(e.enableZoom===!1)return;Me(t),a=n.DOLLY;break;case N.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;se(t),a=n.PAN}else{if(e.enableRotate===!1)return;ie(t),a=n.ROTATE}break;case N.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;ie(t),a=n.ROTATE}else{if(e.enablePan===!1)return;se(t),a=n.PAN}break;default:a=n.NONE}a!==n.NONE&&e.dispatchEvent(J)}function ze(t){switch(a){case n.ROTATE:if(e.enableRotate===!1)return;Ce(t);break;case n.DOLLY:if(e.enableZoom===!1)return;Se(t);break;case n.PAN:if(e.enablePan===!1)return;xe(t);break}}function me(t){e.enabled===!1||e.enableZoom===!1||a!==n.NONE||(t.preventDefault(),e.dispatchEvent(J),Ae(t),e.dispatchEvent(Pe))}function V(t){e.enabled===!1||e.enablePan===!1||Le(t)}function ke(t){switch(ge(t),i.length){case 1:switch(e.touches.ONE){case R.ROTATE:if(e.enableRotate===!1)return;re(),a=n.TOUCH_ROTATE;break;case R.PAN:if(e.enablePan===!1)return;ce(),a=n.TOUCH_PAN;break;default:a=n.NONE}break;case 2:switch(e.touches.TWO){case R.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;De(),a=n.TOUCH_DOLLY_PAN;break;case R.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;je(),a=n.TOUCH_DOLLY_ROTATE;break;default:a=n.NONE}break;default:a=n.NONE}a!==n.NONE&&e.dispatchEvent(J)}function Ye(t){switch(ge(t),a){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;ue(t),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;de(t),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ne(t),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Re(t),e.update();break;default:a=n.NONE}}function fe(t){e.enabled!==!1&&t.preventDefault()}function He(t){i.push(t)}function _e(t){delete v[t.pointerId];for(let o=0;o<i.length;o++)if(i[o].pointerId==t.pointerId){i.splice(o,1);return}}function ge(t){let o=v[t.pointerId];o===void 0&&(o=new E,v[t.pointerId]=o),o.set(t.pageX,t.pageY)}function G(t){const o=t.pointerId===i[0].pointerId?i[1]:i[0];return v[o.pointerId]}e.domElement.addEventListener("contextmenu",fe),e.domElement.addEventListener("pointerdown",pe),e.domElement.addEventListener("pointercancel",k),e.domElement.addEventListener("wheel",me,{passive:!1}),this.update()}}class ot{constructor(){this.scene=new Xe,this.camera=new We(75,window.innerWidth/window.innerHeight,.1,8e3),this.renderer=new Be({antialias:!0,preserveDrawingBuffer:!0}),this.controls=null,this.particles=null,this.pointCloudData=null,this.particleTexture=this.createParticleTexture(),this.settings={particleSize:.1,particleColor:"#372CD5",backgroundColor:"#fff"},this.jsonUrl="https://gmxkwskcrqq1xoty.public.blob.vercel-storage.com/particle-cloud-turbine-246000pts.json",this.init()}init(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(new Ee(this.settings.backgroundColor)),document.getElementById("canvas-container").appendChild(this.renderer.domElement),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.controls=new tt(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!0,this.controls.enableZoom=!1,this.controls.update();const s=new qe(4210752,.1);this.scene.add(s),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}),this.loadJSONPointCloudFromURL(),this.animate()}createParticleTexture(){const s=document.createElement("canvas");s.width=64,s.height=64;const c=s.getContext("2d");return c.beginPath(),c.arc(32,32,32,0,2*Math.PI,!1),c.fillStyle="white",c.fill(),new Ve(s)}async loadJSONPointCloudFromURL(){const s=document.getElementById("error");try{s.style.display="none";const c=await fetch(this.jsonUrl);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const e=await c.json();this.processPointCloud(e)}catch(c){console.error("Error loading point cloud:",c),s.style.display="block",setTimeout(()=>{s.style.display="none"},5e3)}}processPointCloud(s){if(this.particles&&this.scene.remove(this.particles),this.pointCloudData=s,this.particles=this.loadPointCloudFromJSON(s),this.particles)this.scene.add(this.particles),this.fitCameraToPointCloud(),console.log("Point cloud loaded successfully!");else throw new Error("Could not create point cloud from data")}loadPointCloudFromJSON(s){const c=typeof s=="string"?JSON.parse(s):s;if(!c.particles||!c.metadata)return console.error("Invalid JSON format: missing particles or metadata"),null;const e=c.particles,n=c.metadata.quantizationFactor||1,a=c.metadata.originalModelSize||1,m=new Float32Array(e.length*3);e.forEach((p,g)=>{m[g*3]=p[0]/n,m[g*3+1]=p[1]/n,m[g*3+2]=p[2]/n});const r=new Ge;r.setAttribute("position",new Je(m,3));const f=this.settings.particleSize*(a/100),l=new Qe({color:new Ee(this.settings.particleColor),size:f,sizeAttenuation:!0,transparent:!0,opacity:.8,map:this.particleTexture,alphaTest:.5});return new $e(r,l)}fitCameraToPointCloud(){if(!this.particles)return;if(this.pointCloudData&&this.pointCloudData.metadata&&this.pointCloudData.metadata.camera){const l=this.pointCloudData.metadata.camera;l.fov&&(this.camera.fov=l.fov),l.near&&(this.camera.near=l.near),l.far&&(this.camera.far=l.far),this.camera.updateProjectionMatrix();const p=new h(l.target.x,l.target.y,l.target.z),g=new Q(l.distance,l.spherical.phi,l.spherical.theta),y=new h;y.setFromSpherical(g),y.add(p),this.camera.position.copy(y),this.camera.lookAt(p),this.controls&&(this.controls.target.copy(p),this.controls.update()),console.log("Camera position restored from saved data");return}this.particles.geometry.computeBoundingBox();const s=this.particles.geometry.boundingBox,c=s.getSize(new h),e=s.getCenter(new h),a=Math.max(c.x,c.y,c.z)/(2*Math.atan(Math.PI*this.camera.fov/360)),m=a/this.camera.aspect,r=1.2*Math.max(a,m),f=new h(1,1,1).normalize().multiplyScalar(r);this.camera.position.copy(e).add(f),this.controls&&(this.controls.target.copy(e),this.controls.update()),console.log("Camera auto-fitted to point cloud")}animate(){requestAnimationFrame(()=>this.animate()),this.controls&&this.controls.update(),this.renderer.render(this.scene,this.camera)}}window.addEventListener("DOMContentLoaded",()=>{new ot});
